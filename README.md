# UIABot

ДХИС-ийн мэдээллийн технологийн дэмжлэгийн дуудлагыг автоматжуулах телеграм бот.

## Гол боломжууд

- Багш, ажилтнуудаас Able ERP, сүлжээ, программ хангамж, тоног төхөөрөмж, принтер, и-мэйл зэрэг нийтлэг асуудлуудын дуудлага хүлээн авах
- Сонгосон асуудлын төрлөөс хамаарч анхан шатны товч зөвлөгөө өгөх
- Хэрэглэгчийн оруулсан дэлгэрэнгүй тайлбар дээр үндэслэн OpenAI API ашиглан 5-8 алхам бүхий зөвлөмж гаргах
- Зөвлөмж тус болоогүй тохиолдолд МТ-ийн төвийн даргад мэдэгдэж, тухайн өдөр ачаалал багатай инженерт автомат шилжүүлэх
- Дарга эрхээр `/report` командаар тайлан (нийт дуудлага, бүтцийн нэгж, асуудлын төрөл, төлөв) авах боломжтой

## Суурилуулалт

1. Хамааралтай сангуудыг суулгах:

   ```bash
   python -m venv .venv
   source .venv/bin/activate
   pip install -r requirements.txt
   ```

2. Дараах орчны хувьсагчдыг тохируулна:

   | Хувьсагч | Тайлбар |
   | --- | --- |
   | `TELEGRAM_BOT_TOKEN` | Телеграм боты н токен |
   | `OPENAI_API_KEY` | OpenAI API түлхүүр |
   | `OPENAI_MODEL` *(сонголттой)* | Ашиглах OpenAI загварын нэр (`gpt-4o-mini` анхдагч) |
   | `MANAGER_CHAT_ID` | Мэдээллийн технологийн төвийн даргын Telegram chat ID |
   | `ENGINEERS` | Инженерүүдийн жагсаалт. JSON массив хэлбэртэй, жишээ нь: `[{"name": "Инженер А", "chat_id": 123456789}]` |
   | `DATABASE_PATH` *(сонголттой)* | SQLite өгөгдлийн сангийн зам (`data/bot.db` анхдагч) |

   Linux/MacOS дээр жишээ тохиргоо:

   ```bash
   export TELEGRAM_BOT_TOKEN="123456:ABC..."
   export OPENAI_API_KEY="sk-..."
   export MANAGER_CHAT_ID="987654321"
   export ENGINEERS='[{"name": "Инженер А", "chat_id": 111111111}, {"name": "Инженер Б", "chat_id": 222222222}]'
   ```

   `systemd` сервис үүсгэхдээ эдгээр хувьсагчдыг `[Service]` хэсэгт `Environment=` мөрөөр тодорхой зааж өгөөрэй. Жишээ нь:

   ```ini
   [Service]
   Environment=TELEGRAM_BOT_TOKEN=123:abc
   Environment=OPENAI_API_KEY=sk-...
   Environment=OPENAI_MODEL=gpt-4o-mini
   Environment=MANAGER_CHAT_ID=987654321
   Environment=ENGINEERS=[{"name":"Инженер А","chat_id":111111111}]
   ```

   OpenAI API-т холбогдож буй эсэхийг дараах тушаалаар хурдан шалгаж болно:

   ```bash
   curl -s https://api.openai.com/v1/models \
     -H "Authorization: Bearer $OPENAI_API_KEY" | head
   ```

## Ажиллуулах

```bash
python -m bot.main
```

Бот ажиллаж эхэлсний дараа хэрэглэгчид `/start` командаар харилцах боломжтой болно. Дарга эрхтэй хэрэглэгч `/report` командаар тайлан харна.

## Өгөгдлийн сан

Бүх дуудлагын бүртгэл `DATABASE_PATH`-д заасан SQLite файлын `calls` хүснэгтэд хадгалагдана. Тэндээс өдөр тутмын тайлан, инженерийн ачааллыг тооцоолно.

