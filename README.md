# UIABot

ДХИС-ийн мэдээллийн технологийн дэмжлэгийн дуудлагыг автоматжуулах телеграм бот.

## Гол боломжууд

- Багш, ажилтнуудаас Able ERP, сүлжээ, программ хангамж, тоног төхөөрөмж, принтер, и-мэйл зэрэг нийтлэг асуудлуудын дуудлага хүлээн авах
- Ажилтны кодоор баталгаажуулж, код бүртгэлгүй бол дуудлага үүсэхээс сэргийлэх
- Сонгосон асуудлын төрлөөс хамаарч анхан шатны товч зөвлөгөө өгөх
- Хэрэглэгчийн оруулсан дэлгэрэнгүй тайлбар дээр үндэслэн OpenAI API ашиглан 5-8 алхам бүхий зөвлөмж гаргах
- Зөвлөмж тус болоогүй тохиолдолд МТ-ийн төвийн даргад мэдэгдэж, тухайн өдөр ачаалал багатай инженерт автомат шилжүүлэх
- Дарга эрхээр `/report` командаар тайлан (нийт дуудлага, бүтцийн нэгж, асуудлын төрөл, төлөв) авах боломжтой

## Суурилуулалт

1. Хамааралтай сангуудыг суулгах:

   ```bash
   python -m venv .venv
   source .venv/bin/activate
   pip install -r requirements.txt
   ```

2. Дараах орчны хувьсагчдыг тохируулна:

   | Хувьсагч | Тайлбар |
   | --- | --- |
   | `TELEGRAM_BOT_TOKEN` | Телеграм боты н токен |
   | `OPENAI_API_KEY` | OpenAI API түлхүүр |
   | `MANAGER_CHAT_ID` | Мэдээллийн технологийн төвийн даргын Telegram chat ID |
   | `ENGINEERS` | Инженерүүдийн жагсаалт. JSON массив хэлбэртэй, жишээ нь: `[{"name": "Инженер А", "chat_id": 123456789}]` |
   | `EMPLOYEES` | Дуудлага өгөх эрхтэй ажилтнуудын жагсаалт. JSON массив хэлбэртэй, `code`, `full_name`, `department`, `position`, `phone` түлхүүрүүдтэй |
   | `DATABASE_PATH` *(сонголттой)* | SQLite өгөгдлийн сангийн зам (`data/bot.db` анхдагч) |

   Linux/MacOS дээр жишээ тохиргоо:

   ```bash
   export TELEGRAM_BOT_TOKEN="123456:ABC..."
   export OPENAI_API_KEY="sk-..."
   export MANAGER_CHAT_ID="987654321"
   export ENGINEERS='[{"name": "Инженер А", "chat_id": 111111111}, {"name": "Инженер Б", "chat_id": 222222222}]'
   export EMPLOYEES='[
     {"code": "D001", "full_name": "Багш А", "department": "МТ төв", "position": "Ахлах мэргэжилтэн", "phone": "99112233"},
     {"code": "D002", "full_name": "Багш Б", "department": "Санхүү", "position": "Нягтлан", "phone": "88112233"}
   ]'
   ```

## Ажиллуулах

```bash
python -m bot.main
```

Бот ажиллаж эхэлсний дараа хэрэглэгчид `/start` командаар харилцах боломжтой болно. Дарга эрхтэй хэрэглэгч `/report` командаар тайлан харна.

## Өгөгдлийн сан

Бүх дуудлагын бүртгэл `DATABASE_PATH`-д заасан SQLite файлын `calls` хүснэгтэд хадгалагдана. `employees` хүснэгтэд ажилтнуудын код, нэр, албан тушаал, утас, бүтцийн нэгжийн мэдээллийг хадгалж, бот эхлэх бүрт `EMPLOYEES` орчноос синк хийдэг. Тэндээс өдөр тутмын тайлан, инженерийн ачааллыг тооцоолно.

