# UIABot

ДХИС-ийн мэдээллийн технологийн дэмжлэгийн дуудлагыг автоматжуулах телеграм бот.

## Гол боломжууд

- Багш, ажилтнуудаас Able ERP, сүлжээ, программ хангамж, тоног төхөөрөмж, принтер, и-мэйл зэрэг нийтлэг асуудлуудын дуудлага хүлээн авах
- Сонгосон асуудлын төрлөөс хамаарч анхан шатны товч зөвлөгөө өгөх
- Хэрэглэгчийн оруулсан дэлгэрэнгүй тайлбар дээр үндэслэн OpenAI API ашиглан 5-8 алхам бүхий зөвлөмж гаргах
- Зөвлөмж тус болоогүй тохиолдолд МТ-ийн төвийн даргад мэдэгдэж, 10 минутын дотор инженер оноогоогүй бол тухайн өдөр ачаалал багатай инженерт автоматаар шилжүүлэх
- Дарга эрхээр `/report` командаар тайлан (нийт дуудлага, бүтцийн нэгж, асуудлын төрөл, төлөв) авах боломжтой
- Менежер эрхээр `/add_employee` командаар ажилтны код, овог нэрийг нэмж/шинэчилж болно
- Дарга эрхтэйгээр `/assign_call ДУУДЛАГЫН_ID ИНЖЕНЕР_НЭР` командаар дуудлагыг инженерүүдийн аль нэгэнд гар аргаар оноож болно

## Суурилуулалт

1. Хамааралтай сангуудыг суулгах:

   ```bash
   python -m venv .venv
   source .venv/bin/activate
   pip install -r requirements.txt
   ```

2. Төслийн үндсэн хавтас дотор `.env` файл үүсгээд дараах орчны хувьсагчдыг нэг удаа тохируулна. Бот ажиллах болгонд энэ файл
   автоматаар уншигдана:

   | Хувьсагч | Тайлбар |
   | --- | --- |
   | `TELEGRAM_BOT_TOKEN` | Телеграм боты н токен |
   | `OPENAI_API_KEY` | OpenAI API түлхүүр |
   | `MANAGER_CHAT_ID` | Мэдээллийн технологийн төвийн даргын Telegram chat ID |
   | `ENGINEERS` | Инженерүүдийн жагсаалт. JSON массив хэлбэртэй, жишээ нь: `[{"name": "Инженер А", "chat_id": 123456789}]` |
   | `EMPLOYEE_CODES` *(сонголттой)* | Дуудлага өгөхийг зөвшөөрсөн ажилтнуудын кодын JSON жагсаалт эсвэл объект. Жишээ нь: `["IT-001", "IT-002"]`. Эдгээр код нь өгөгдлийн санд автоматаар нэмэгдэхгүй тул `/add_employee` командаар овог, нэртэй нь бүртгэж болно. |
   | `DATABASE_PATH` *(сонголттой)* | SQLite өгөгдлийн сангийн зам (`data/bot.db` анхдагч) |

   Linux/MacOS дээр жишээ тохиргоо:

   ```bash
   TELEGRAM_BOT_TOKEN="123456:ABC..."
   OPENAI_API_KEY="sk-..."
   MANAGER_CHAT_ID="987654321"
   ENGINEERS='[{"name": "Инженер А", "chat_id": 111111111}, {"name": "Инженер Б", "chat_id": 222222222}]'
   EMPLOYEE_CODES='["IT-001", "IT-002"]'
   ```

   `.env` файлуудад `KEY=VALUE` болон `export KEY=VALUE` аль алиныг нь ашиглаж болно — эхний утга давхар бичигдэхгүй.

## Ажиллуулах

```bash
python -m bot.main
```

Бот ажиллаж эхэлсний дараа хэрэглэгчид `/start` командаар харилцах боломжтой болно. Дарга эрхтэй хэрэглэгч `/report` командаар тайлан харна.

## Өгөгдлийн сан

Бүх дуудлагын бүртгэл `DATABASE_PATH`-д заасан SQLite файлын `calls` хүснэгтэд хадгалагдана. Тэндээс өдөр тутмын тайлан, инженерийн ачааллыг тооцоолно.

