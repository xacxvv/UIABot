# UIABot

ДХИС-ийн мэдээллийн технологийн дэмжлэгийн дуудлагыг автоматжуулах телеграм бот.

## Гол боломжууд

- Багш, ажилтнуудаас Able ERP, сүлжээ, программ хангамж, тоног төхөөрөмж, принтер, и-мэйл зэрэг нийтлэг асуудлуудын дуудлага хүлээн авах
- Ажилтны кодоор баталгаажуулж, код бүртгэлгүй бол дуудлага үүсэхээс сэргийлэх
- Сонгосон асуудлын төрлөөс хамаарч анхан шатны товч зөвлөгөө өгөх
- Хэрэглэгчийн оруулсан дэлгэрэнгүй тайлбар дээр үндэслэн OpenAI Responses API (`gpt-5-nano` анхдагч) ашиглан 5-8 алхам бүхий зөвлөмж гаргах
- Зөвлөмж тус болоогүй тохиолдолд МТ-ийн төвийн даргад мэдээлж, дарга `/assign` командаар тухайн өдөр ажиллаж буй инженерт гар аргаар оноох
- Дарга эрхээр `/report` командаар тайлан (нийт дуудлага, бүтцийн нэгж, асуудлын төрөл, төлөв, инженер бүрийн хүлээн авсан/шийдвэрлэсэн дуудлагын тоо) авах боломжтой

## Суурилуулалт

1. Хамааралтай сангуудыг суулгах:

   ```bash
   python -m venv .venv
   source .venv/bin/activate
   pip install -r requirements.txt
   ```

2. Дараах орчны хувьсагчдыг тохируулна:

   | Хувьсагч | Тайлбар |
   | --- | --- |
   | `TELEGRAM_BOT_TOKEN` | Телеграм боты н токен |
   | `OPENAI_API_KEY` | OpenAI API түлхүүр |
   | `MANAGER_CHAT_ID` | Мэдээллийн технологийн төвийн даргын Telegram chat ID |
   | `ENGINEERS` | Инженерүүдийн жагсаалт. JSON массив хэлбэртэй, жишээ нь: `[{"name": "Инженер А", "chat_id": 123456789}]` |
   | `EMPLOYEES` | Дуудлага өгөх эрхтэй ажилтнуудын жагсаалт. JSON массив хэлбэртэй, `code`, `full_name`, `department`, `position`, `phone` түлхүүрүүдтэй. Ажилтны код 6 оронтой тоо байх ёстой |
   | `DATABASE_PATH` *(сонголттой)* | SQLite өгөгдлийн сангийн зам (`data/bot.db` анхдагч) |

   Linux/MacOS дээр жишээ тохиргоо:

   ```bash
   export TELEGRAM_BOT_TOKEN="123456:ABC..."
   export OPENAI_API_KEY="sk-..."
   export MANAGER_CHAT_ID="987654321"
   export ENGINEERS='[{"name": "Инженер А", "chat_id": 111111111}, {"name": "Инженер Б", "chat_id": 222222222}]'
   export EMPLOYEES='[
     {"code": "123456", "full_name": "Бат", "department": "Цагдаагийн сургуулийн Гүйцэтгэх ажлын тэнхим", "position": "Ахлах багш", "phone": "88888888"}
   ]'
   ```

   Хэрэв танд бэлэн ажилтны жагсаалт байхгүй бол туршилтын зориулалттай `data/sample_employees.json` файлыг ашиглаж болно. Файлыг орчны хувьсагчид ачаалах хамгийн хялбар арга бол:

   ```bash
   export EMPLOYEES="$(cat data/sample_employees.json)"
   ```

   Энэ жишээнд `123456` кодтой Бат багш ашиглагддаг бөгөөд `/start` командаар орж ирэн дуудлага өгөхдөө тухайн кодыг оруулж түүхэн урсгалыг шалгаж болно.

## Ажиллуулах

```bash
python -m bot.main
```

Бот ажиллаж эхэлсний дараа хэрэглэгчид `/start` командаар харилцах боломжтой болно. Дарга эрхтэй хэрэглэгчид хоёр нэмэлт команд ашиглана:

- `/report` – тайлан (нийт дуудлага, бүтцийн нэгж, асуудлын төрөл, төлөв, инженер бүрийн статистик)
- `/assign <дуудлагын ID> <инженерийн нэр>` – дуудлагыг тухайн өдөр ажиллаж буй, сонгосон инженер лүү оноох. Бот менежерт ирүүлсэн мэдэгдэлд дуудлагын ID, боломжит инженерүүдийн нэр болон товчнууд гарч ирэх тул товч дарж оноох эсвэл командыг гараар бичиж болно.

## Өгөгдлийн сан

Бүх дуудлагын бүртгэл `DATABASE_PATH`-д заасан SQLite файлын `calls` хүснэгтэд хадгалагдана. `employees` хүснэгтэд ажилтнуудын код, нэр, албан тушаал, утас, бүтцийн нэгжийн мэдээллийг хадгалж, бот эхлэх бүрт `EMPLOYEES` орчноос синк хийдэг. Тэндээс өдөр тутмын тайлан, инженерийн ачааллыг тооцоолно.

